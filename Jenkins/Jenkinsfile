pipeline {
    agent any
    stages {
        stage('---clean---') {
            steps {
                dir("project") {
                    sh "mvn clean -Dhttp.protocols=TLSv1.2"
                }
            }
        }
        stage('--test--') {
            steps {
                dir("project") {
                    sh "mvn test"
                }
            }
        }
        stage('--package--') {
            steps {
                dir("project") {
                    sh "mvn package -Dhttps.protocols=TLSv1.2"
                }
            }
        }
    }
    stage('Deploying to TEST') {

        sshPublisher {
            server('10.128.0.5') {
                credentials('nanii_tolea') {
                    key: ''
                    '-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA3ALzCKy96dzhOfuZv0XULNuwPNfPP3InKBrv+aBeFi0vTLHE
vB27XouvEsE3C3ksbciFk9fJ0YRPaP6XmKm5nyDyP/2CBNrsbm4+ver2wp8tvbt6
FbZdlXticq/gMkF06bjgjeSqN8YMwVadXSdaY77qDZwDC1CHb+szmkgId3MiPIal
GUHpFveIj16t70qW1fotNrfvoBjLWAyUSa9cQCjN9cQhRUmM0Dli5roH7rpPt8KQ
nJeA29Ad9pbUMllqSDkQFsTWwsccq/AGi7hPUVa4l53da6h6fQNhAZzBH7Xt0bFV
TDRgqBebQYstRptP4tB0EDxv6eQhS4Y6leu3OwIDAQABAoIBAETYt2yTgapY8DHQ
xb/Q/iA7bt7bOYNFGXO3WjjnMgoGgbKiPkoPk752P4bC55KzjG+ePA6TjBgAK0lT
weSH2AovqR7VGYajazDzVrbfe/BTF2Ez9XQt6QMJ5Ti2SJXxXcB1le9RCuMBGqS1
kfDAi8yCxYMUuu8jd/5Rv4gb2mpmDEPftTk1f0GmhwjIOJ2RkNdXcagF2i9nvXu8
eiOVkkqSD0KLrz5Xd7Hoi6AzFcvBWz91075wDEHb/V6QayDDVfMJ0KSMlwUG5LTj
IbyAALQL8HwfDXLLo2MoERMbZnA6QM9DqNplJIfjo3Pa4+fd7wZaZVi5yYLBcX81
R8yOImECgYEA9hGVlqyCTCBAlcqtageG0uIqsNGURJXAKrmdXi7QnFCX/iazUsEt
ksf92BvU1I85alIXy0Vku0LfXqQcett9jeK2RP5WK8RwDrUyHVKlFzEEz8/etepB
o1S55hKOoUg8HMm7MQ1tz5DztMd70bltN4xuVvJ55Ojjuc8vaP/NuRcCgYEA5OQj
hgy+6IVls2ngO8tGwZgh3F7ao+81kHKR4/dsFURx+yRcuwRzLpfVUBBEPuv42DR4
jKov/fJQrQPpub4jB5uXBQljMGQTuZT6PukQDvtcyawKVPhgH1Lit8LPSnzw5AlA
/N+UssgL12dbNPhCuw+2TWlEfMQ/ajlLy9JCwX0CgYAoM3k/85EaBM7oagNo5i/l
tiOJXcQebGTH1ilaoMVeNGCQmhwD8iGS8G+NZgagb4HO1/ihMgYh/evmV2N7wu5B
Rv/GR9MmNWKlVH8KgV0Na+nAVdKp38q3d3kjmHaK7PU9MswNWIdPOPxH1atp+SRZ
xeyk8dpuRool6i5xthETIwKBgQCpTgbotKzRmTpsxzfRgr7HnBwPwSnAcMQSIGzB
TtZntMUKmw7sVpJMOIrUOfQBBtJ+OfGhOpFdKct67pYHihinG/NNCnCP7raYYxXn
SsVSD6PGmLbbuwx+nvSMMFDcLCaSxjWH1mlLBKWdoxnXyHqzmx+hiufZ0d+GVvM1
xEUUkQKBgDL/cc1k9PBGBgdNxAwDUehki6u7L+Jog/yoCIcEvbz+rfhfdQG1qKzl
FS8l+t3g+tC0NPbLxrAyMbZvoDQuBVKgNuJj7l4B02GSnjRLxtnnaKYu7rajvfYf
FlcTV9EP1r3XoR/OB2LMx3sQ1zvQ8EcudPJNvL3bAyGmKfh2NdEg
-----END RSA PRIVATE KEY-----''
                    '
                }
                label('doker_test')
                transferSet {
                    sourceFiles("/var/lib/jenkins/workspace/Access Control System Pipeline/project/AccessControlSystem-Client/target/AccessControlSystem-Client-0.0.1-SNAPSHOT.jar")
                    remoteDirectory('/')
                    execCommand('mkdir deployfolder & unzip myproject-${version}.zip')
                }
            }
        }
    }
}
